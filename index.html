<!doctype html>
<html lang="he">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>שורה לשמירה</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; padding: 2rem; direction: rtl; }
    .container { max-width: 600px; margin: 0 auto; }
    label { display:block; margin-bottom: .5rem; font-weight: 600; }
    input[type="text"] {
      width: 100%;
      padding: .6rem .8rem;
      font-size: 1rem;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .row { display:flex; gap:.5rem; margin-top:.75rem; }
    button { padding:.5rem .75rem; border-radius:6px; border:1px solid #888; background:#f5f5f5; cursor:pointer; }
    button:active { transform: translateY(1px); }
    .status { margin-top:.75rem; color:#2b7a0b; }
  </style>
</head>
<body>
  <div class="container">
    <h2>שורה אחת שנשמרת</h2>

    <label for="singleLine">הכנס/י טקסט לשורה (נשמר אוטומטית)</label>
    <input id="singleLine" type="text" placeholder="כתוב כאן..." autocomplete="off" />

    <div class="row">
      <button id="clearBtn" title="נקה את הטקסט והשמור">נקה</button>
      <button id="exportBtn" title="העתק את הטקסט ללוח">העתק ללוח</button>
    </div>

    <div class="status" id="status" aria-live="polite"></div>
  </div>

  <script>
    const KEY = 'singleLineSaved';
    const input = document.getElementById('singleLine');
    const status = document.getElementById('status');
    const clearBtn = document.getElementById('clearBtn');
    const exportBtn = document.getElementById('exportBtn');

    // טען מה-localStorage בעת פתיחת הדף
    input.value = localStorage.getItem(KEY) || '';

    // שמירה אוטומטית בכל שינוי (חוסך לחיצה)
    let saveTimeout = null;
    function showStatus(text, timeout = 1500) {
      status.textContent = text;
      if (timeout > 0) {
        setTimeout(() => {
          if (status.textContent === text) status.textContent = '';
        }, timeout);
      }
    }

    function saveNow() {
      try {
        localStorage.setItem(KEY, input.value);
        showStatus('נשמר');
      } catch (e) {
        showStatus('שגיאה בשמירה: ' + e.message, 4000);
      }
    }

    input.addEventListener('input', () => {
      // שמירה מאוחרת (debounce) כדי לא לשמור כל תו
      if (saveTimeout) clearTimeout(saveTimeout);
      saveTimeout = setTimeout(saveNow, 400);
    });

    // שמירה גם כש לוחצים Enter
    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        input.blur();
        saveNow();
      }
    });

    clearBtn.addEventListener('click', () => {
      input.value = '';
      saveNow();
      showStatus('נוקה ונשמר');
    });

    exportBtn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(input.value);
        showStatus('הטקסט הועתק ללוח');
      } catch (e) {
        showStatus('לא הצליח להעתיק: ' + e.message, 3000);
      }
    });

    // שמירה לפני סגירת הדף (מקרה קצה)
    window.addEventListener('beforeunload', () => {
      localStorage.setItem(KEY, input.value);
    });
  </script>
</body>
</html>
