<!doctype html>
<html lang="he">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>רשימת שורות נשמרת</title>
  <style>
    :root { --gap: 0.6rem; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
    body { padding: 2rem; direction: rtl; background: #fafafa; color:#111; }
    .wrap { max-width:700px; margin:0 auto; background:white; padding:1.2rem; border-radius:10px; box-shadow:0 6px 18px rgba(0,0,0,0.06); }
    h1 { margin:0 0 1rem 0; font-size:1.2rem; }
    .controls { display:flex; gap:var(--gap); margin-bottom: .75rem; align-items:center; }
    input[type="text"] { flex:1; padding:.6rem .8rem; font-size:1rem; border:1px solid #ddd; border-radius:8px; }
    button { padding:.55rem .75rem; border-radius:8px; border:1px solid #ccc; background:#f5f5f5; cursor:pointer; }
    button.primary { background:#2b7aee; color:white; border-color: #1f5fd6; }
    ul { list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:.5rem; }
    li { display:flex; gap:.5rem; align-items:center; padding:.5rem; border-radius:8px; border:1px solid #eee; background: #fff; }
    .text { flex:1; word-break:break-word; padding-right:.25rem; }
    .meta { color:#666; font-size:.85rem; margin-left:.5rem; }
    .empty { color:#777; padding:.8rem; text-align:center; }
    .small { font-size:.85rem; color:#666; }
  </style>
</head>
<body>
  <div class="wrap" role="application" aria-label="שורת טקסט נשמרת">
    <h1>הוסף שורה — הרשימה נשמרת אוטומטית</h1>

    <div class="controls">
      <input id="lineInput" type="text" placeholder="הקלד כאן שורה חדשה ואז לחץ הוסף או Enter" autocomplete="off" />
      <button id="addBtn" class="primary">הוסף</button>
      <button id="clearAllBtn" title="נקה את כל הרשימה">נקה הכל</button>
    </div>

    <div class="small">ניתן למחוק שורה באמצעות כפתור ה-X משמאל.</div>

    <ul id="list" aria-live="polite"></ul>
    <div id="empty" class="empty" hidden>אין שורות עדיין.</div>

    <div style="margin-top:.8rem; display:flex; gap:.5rem;">
      <button id="exportBtn">העתק את כל הרשימה ללוח</button>
      <button id="importBtn">ייבא רשימת דוגמה</button>
    </div>
  </div>
<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-analytics.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyB-yEX8EutF_Ds6sLaFSdToWRqnM2shUUc",
    authDomain: "project-124056294089354005.firebaseapp.com",
    projectId: "project-124056294089354005",
    storageBucket: "project-124056294089354005.firebasestorage.app",
    messagingSenderId: "566837476259",
    appId: "1:566837476259:web:c3fc8ea1943653fdd2b816",
    measurementId: "G-5D0K55650J"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
</script>
  <script>
    const STORAGE_KEY = 'savedLines_v1';
    const input = document.getElementById('lineInput');
    const addBtn = document.getElementById('addBtn');
    const listEl = document.getElementById('list');
    const emptyEl = document.getElementById('empty');
    const clearAllBtn = document.getElementById('clearAllBtn');
    const exportBtn = document.getElementById('exportBtn');
    const importBtn = document.getElementById('importBtn');

    // טעינת רשימה מ-localStorage
    let lines = load();

    function load() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : [];
      } catch (e) {
        console.error('Failed to load:', e);
        return [];
      }
    }

    function save() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(lines));
      } catch (e) {
        console.error('Failed to save:', e);
      }
    }

    function render() {
      listEl.innerHTML = '';
      if (!lines.length) {
        emptyEl.hidden = false;
        return;
      }
      emptyEl.hidden = true;
      // הצגת פריטים בסדר הוספה (חדשים למטה). אם רוצים הפוך - שנה את המיון
      lines.forEach(item => {
        const li = document.createElement('li');

        const txt = document.createElement('div');
        txt.className = 'text';
        txt.textContent = item.text;

        const meta = document.createElement('div');
        meta.className = 'meta';
        const d = new Date(item.ts);
        meta.textContent = d.toLocaleString('he-IL');

        const del = document.createElement('button');
        del.title = 'מחק שורה';
        del.innerHTML = '✖';
        del.addEventListener('click', () => {
          lines = lines.filter(x => x.id !== item.id);
          save();
          render();
        });

        li.appendChild(del);
        li.appendChild(txt);
        li.appendChild(meta);
        listEl.appendChild(li);
      });
    }

    function addLine(text) {
      const trimmed = (text || '').trim();
      if (!trimmed) return;
      const item = { id: Date.now().toString() + Math.random().toString(36).slice(2), text: trimmed, ts: Date.now() };
      lines.push(item);
      save();
      render();
    }

    // אירועים
    addBtn.addEventListener('click', () => {
      addLine(input.value);
      input.value = '';
      input.focus();
    });

    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        addBtn.click();
      }
    });

    clearAllBtn.addEventListener('click', () => {
      if (!confirm('למחוק את כל השורות?')) return;
      lines = [];
      save();
      render();
    });

    exportBtn.addEventListener('click', async () => {
      const text = lines.map(l => l.text).join('\n');
      try {
        await navigator.clipboard.writeText(text);
        alert('העתקתי את כל הרשימה ללוח.');
      } catch (e) {
        // גיבוי: הצגת הטקסט להעתקה ידנית
        prompt('העתק את הטקסט מכאן:', text);
      }
    });

    // דוגמה לייבוא מהיר (לא הכרחי) — מוסיף כמה שורות דמו
    importBtn.addEventListener('click', () => {
      const sample = ['שורה ראשונה', 'עוד שורה', 'משהו רנדומלי'].map(t => ({ id: Date.now().toString() + Math.random().toString(36).slice(2), text: t, ts: Date.now() }));
      lines = lines.concat(sample);
      save();
      render();
    });

    // רנדר התחלי
    render();

    // שמירה נוספת לפני עזיבת העמוד (מקרה קצה)
    window.addEventListener('beforeunload', () => save());
  </script>
</body>
</html>
