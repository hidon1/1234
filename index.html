<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>חיבור Firebase וגוגל</title>
</head>
<body>

    <h2>מערכת שמירת נתונים</h2>
    
    <button id="loginBtn">התחבר עם Google</button>
    
    <hr>

    <div id="dataSection" style="display:none;">
        <input type="text" id="userInput" placeholder="הקלד טקסט לשמירה">
        <button id="saveBtn">שמור במסד הנתונים</button>
        <p id="status"></p>
    </div>

    <script type="module">
        // ייבוא הפונקציות הנדרשות מ-Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // הגדרות הפרויקט שלך (כפי שסיפקת)
        const firebaseConfig = {
            apiKey: "AIzaSyCRXyTlTe9u9bjvL6Y3eUnztesa27hkWaY",
            authDomain: "project-2118807878810546832.firebaseapp.com",
            projectId: "project-2118807878810546832",
            storageBucket: "project-2118807878810546832.firebasestorage.app",
            messagingSenderId: "519860367831",
            appId: "1:519860367831:web:488f364c2e51d27b6a5b92"
        };

        // אתחול Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        const loginBtn = document.getElementById('loginBtn');
        const dataSection = document.getElementById('dataSection');
        const saveBtn = document.getElementById('saveBtn');
        const status = document.getElementById('status');

        // פונקציית התחברות עם גוגל
        loginBtn.onclick = async () => {
            try {
                const result = await signInWithPopup(auth, provider);
                alert("שלום " + result.user.displayName);
                loginBtn.style.display = 'none'; // הסתרת כפתור התחברות
                dataSection.style.display = 'block'; // הצגת טופס השמירה
            } catch (error) {
                console.error("שגיאה בהתחברות:", error);
            }
        };

        // פונקציית שמירת נתונים ל-Firestore
        saveBtn.onclick = async () => {
            const text = document.getElementById('userInput').value;
            if (!text) return alert("נא להזין טקסט");

            try {
                // שמירה לאוסף שנקרא 'messages'
                await addDoc(collection(db, "messages"), {
                    content: text,
                    userId: auth.currentUser.uid,
                    userName: auth.currentUser.displayName,
                    timestamp: new Date()
                });
                status.innerText = "הנתונים נשמרו בהצלחה!";
                document.getElementById('userInput').value = "";
            } catch (error) {
                console.error("שגיאה בשמירה:", error);
                status.innerText = "שגיאה: וודא שהגדרת הרשאות ב-Firebase Console";
            }
        };
    </script>
</body>
</html>
